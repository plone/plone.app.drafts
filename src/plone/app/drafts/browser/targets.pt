<tal:block tal:define="
             userId request/userId;
             targets python:context.drafts.get(userId, {});
           "
           i18n:domain="plone.app.drafts"
>

  <div tal:replace="structure context/manage_page_header"></div>
  <div tal:replace="structure context/manage_tabs"></div>

  <h2 i18n:translate="heading_drafts">Drafts</h2>

  <p i18n:translate="description_drafts">
    Drafts are created when a page is edited and has not yet been saved.
    A draft found here represents either a content item currently being
    edited, an item that has been abandoned, e.g. because of a browser crash.
  </p>

  <a tal:attributes="
       href string:${context/absolute_url}/@@overview;
     "
     i18n:translate="link_return_to_overview"
  >Return to overview</a>

  <strong tal:condition="not:targets"
          i18n:translate="description_no_drafts"
  >
    No drafts found
  </strong>

  <tal:block condition="targets">

    <h3 i18n:translate="heading_targets">Drafts for
      <span tal:content="userId"
            i18n:name="userId"
      ></span></h3>

    <p i18n:translate="description_targets">
        Drafts are organised by the target object. Click on a key below to
        view drafts for this item.
    </p>

    <form method="post"
          tal:attributes="
            action request/getURL;
          "
    >
      <input name="userId"
             type="hidden"
             tal:attributes="
               value userId;
             "
      />
      <div tal:repeat="targetKey targets">
        <input name="targetKeys:list"
               type="checkbox"
               tal:attributes="
                 value targetKey;
               "
        />
        <tal:block define="
                     targetInfo python:view.targetInfo(targetKey);
                     quotedKey python:view.quote(targetKey);
                   ">
          <span tal:condition="targetInfo/child"
                i18n:translate="description_not_yet_created"
          >
                    Object of type
            <span tal:content="targetInfo/portal_type"
                  i18n:name="portal_type"
            ></span>
                    being added to
          </span>

          <span tal:content="targetInfo/title"
                tal:attributes="
                  title targetInfo/url | nothing;
                "
          ></span>

                &mdash;

          <a tal:attributes="
               href string:${context/absolute_url}/@@drafts?userId=${userId}&amp;targetKey=${quotedKey};
             "
             i18n:translate="view_drafts"
          >
                    View drafts
          </a>

          <span tal:condition="targetInfo/url">
                    |
            <a tal:condition="targetInfo/url"
               tal:attributes="
                 href targetInfo/url;
               "
               i18n:translate="view_content_object"
            >View content object</a>
          </span>
        </tal:block>
      </div>

      <div>&nbsp;</div>

      <div>
        <input name="form.button.PruneTargets"
               type="submit"
               value="Remove drafts for selected targets"
               i18n:attributes="value remove_drafts_from_targets"
        />
      </div>
    </form>

  </tal:block>

  <div tal:replace="structure context/manage_page_footer"></div>

</tal:block>
