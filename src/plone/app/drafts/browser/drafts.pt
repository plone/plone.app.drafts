<tal:block tal:define="
             userId request/userId;
             targetKey request/targetKey;
             targetInfo python:view.targetInfo(targetKey);
             drafts python:context.drafts.get(userId, {}).get(targetKey, {});
           "
           i18n:domain="plone.app.drafts"
>

  <div tal:replace="structure context/manage_page_header"></div>
  <div tal:replace="structure context/manage_tabs"></div>

  <h2 i18n:translate="heading_drafts">Drafts</h2>

  <p i18n:translate="description_drafts">
    Drafts are created when a page is edited and has not yet been saved.
    A draft found here represents either a content item currently being
    edited, an item that has been abandoned, e.g. because of a browser crash.
  </p>

  <a tal:attributes="
       href string:${context/absolute_url}/@@overview;
     "
     i18n:translate="link_return_to_overview"
  >Return to overview</a>

  <strong tal:condition="not:drafts"
          i18n:translate="description_no_drafts"
  >
    No drafts found
  </strong>

  <tal:block condition="drafts">

    <h3 i18n:translate="heading_targets">Drafts for
      <span tal:content="userId"
            i18n:name="userId"
      ></span>
        on
      <span tal:content="targetInfo/title"
            i18n:name="targetTitle"
      ></span></h3>

    <p i18n:translate="description_current_drafts">
        The following drafts are in progress.
    </p>

    <form method="post"
          tal:attributes="
            action request/getURL;
          "
    >

      <input name="userId"
             type="hidden"
             tal:attributes="
               value userId;
             "
      />
      <input name="targetKey"
             type="hidden"
             tal:attributes="
               value targetKey;
             "
      />

      <div tal:repeat="draft drafts">
        <tal:block define="
                     draftInfo python:view.draftInfo(drafts[draft]);
                   ">
          <input name="draftNames:list"
                 type="checkbox"
                 tal:attributes="
                   value draft;
                 "
          />
          <span tal:condition="draftInfo/mtime"
                i18n:translate="draft_mtime"
          >
                    Last modified:
            <span tal:content="python:draftInfo['mtime'].isoformat()"
                  i18n:name="mtime"
            ></span>
          </span>
        </tal:block>
      </div>

      <div>&nbsp;</div>

      <div>
        <input name="form.button.PruneDrafts"
               type="submit"
               value="Remove selected drafts"
               i18n:attributes="value submit_remove_draft"
        />
      </div>
    </form>

  </tal:block>

  <div tal:replace="structure context/manage_page_footer"></div>

</tal:block>
